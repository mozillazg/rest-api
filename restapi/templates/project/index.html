{% extends "base.html" %}

{% block title %}projects{% endblock title %}

{% block content %}
<div class="row">
  <h1>Projects
    <small><a class="label label-primary" href="{{ url_for('projects.create') }}">New Project</a></small>
  </h1>
</div>

  <div class="row">
      <table class="table table-striped table-bordered table-hover">
        <thead>
          <tr>
            <th>title</th>
            <th>urlname</th>
            <th>description</th>
            <th>action</th>
          </tr>
        </thead>
        <tbody>
          {% for project in projects %}
          <tr>
            <td><a href="">{{ project.title }}</a></td>
            <td>{{ project.urlname }}</td>
            <td>{{ project.description or '' }}</td>
            <td>
              <a class="label label-primary" href="{{ url_for('projects.edit', urlname=project.urlname) }}" >edit</a>
              <a class="delete_record label label-danger" href="javascript: void(0);"
                data-id="{{ project.urlname }}">delete</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
  </div>

{% endblock content %}


{% block extra_js %}
<script>
  $(function() {
    $(".delete_record").on("click", function() {
      if (!confirm("确定要删除?")) {
        return false;
      }
      var id = $(this).data("id");
      $.ajax({
        type: "DELETE",
        url: "{{ url_for('projects.view', urlname='0') }}".replace("0", id),
        dataType: "json",
        success: function(data) {
          location.reload();
        }
      });
    });
  });

</script>
{% endblock extra_js %}
